name: ci

on:
  pull_request:
  push:

jobs:
  gen:
    name: Check generated code
    runs-on: ubuntu-latest
    steps:
      - name: Checkout source code
        uses: actions/checkout@v4
      - name: Setup requirements
        uses: ./.github/actions/setup
      - name: Re-generate code
        run: pnpm gen
      - name: Check for uncommitted changes
        id: changes
        uses: UnicornGlobal/has-changes-action@v1.0.11
      - name: Fail if uncommitted changes
        if: steps.changes.outputs.changed == 1
        run: exit 1
  test:
    name: Run tests
    runs-on: ubuntu-latest
    steps:
      - name: Checkout source code
        uses: actions/checkout@v4
      - name: Setup requirements
        uses: ./.github/actions/setup
      - name: Run tests
        run: pnpm test
  test-e2e:
    name: Run e2e tests
    runs-on: ubuntu-latest
    steps:
      - name: Checkout source code
        uses: actions/checkout@v4
      - name: Setup requirements
        uses: ./.github/actions/setup
      - name: Run e2e tests
        run: pnpm test:e2e